<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
<link rel="stylesheet" href="http://fontawesome.io/assets/font-awesome/css/font-awesome.css">
<!-- <link rel="icon" href="icon.png" type="image/png"> -->
<title>臺北101互動煙火</title>

<style type="text/css">
/* 背景照片設定，可以換成任意圖片 */
#bg {
  background-image: url("https://3.bp.blogspot.com/-HpsMT0KcbQg/WF4DAS6g2SI/AAAAAAADARA/mYMs6VLhoZYe0VL-Olyw9hnR0BilT-ZywCLcB/s1600/bg2.jpg");
}
/* 其他設定 */
html,body{height:100%;margin:0;padding:0;overflow-y:hidden;}ul,li{text-indent:0;text-decoration:none;margin:0;padding:0}img{border:0}body{background-color:#000;color:#999;font:100%/18px helvetica,arial,sans-serif}canvas{cursor:crosshair;display:block;left:0;position:absolute;top:0;z-index:20}#header img{width:100%;height:20%}#bg img{width:100%;height:80%}#header,#bg{position:fixed;left:0;right:0;z-index:10}#header{top:0}#bg{position:fixed;z-index:1;bottom:0}audio{position:fixed;display:none;bottom:0;left:0;right:0;width:100%;z-index:5}.webdesign{width:30%;position:absolute;top:0;left:0;font-family:tahoma;text-decoration:none;color:#232323;font-size:11px}.webdesign2{position:absolute;top:0;right:0;font-family:tahoma;text-decoration:none;color:#232323;font-size:11px}#bgimg{display:none}#bgimg1{display:block}@media screen and (max-width:500px){#bgimg1{display:none}#bgimg{display:block}}

@media (min-width: 800px) {
  #bg {
    background-position: center top !important;
    
  }
  
}

</style>

</head>

<body>

<!--
來源網頁：http://parsico.net/pages/fw/
照片來源：臺北101官方網站 http://www.taipei-101.com.tw/
-->

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script><a class="webdesign" href="http://blog.pulipuli.info/" title="布丁布丁吃什麼">布丁布丁吃什麼</a>
<div id="bg" style="    background-image: url('https://3.bp.blogspot.com/-HpsMT0KcbQg/WF4DAS6g2SI/AAAAAAADARA/mYMs6VLhoZYe0VL-Olyw9hnR0BilT-ZywCLcB/s1600/bg2.jpg');
    height: calc(100vh - 0px);
    width: 100%;
    background-position: center bottom;
    background-repeat: no-repeat;
    background-size: cover;">
<!--
    <img id="bgimg" src="./Pars Fanavaran_files/bg1.jpg"><img id="bgimg1" src="./Pars Fanavaran_files/bg2.jpg">
-->
</div>

<canvas width="660" height="950"></canvas>

<script type="text/javascript">
$(function(){

var Parsicofw = function(){
var self = this;
var rand = function(rMi, rMa){return ~~((Math.random()*(rMa-rMi+1))+rMi);}
var hitTest = function(x1, y1, w1, h1, x2, y2, w2, h2){return !(x1 + w1 < x2 || x2 + w2 < x1 || y1 + h1 < y2 || y2 + h2 < y1);};
window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}();

self.init = function(){ 
self.canvas = document.createElement('canvas');       
self.canvas.width = self.cw = $(window).innerWidth();
self.canvas.height = self.ch = $(window).innerHeight();     
self.particles = [];  
self.partCount = 150;
self.parsicofw = [];  
self.mx = self.cw/2;
self.my = self.ch/2;
self.currentHue = 30;
self.partSpeed = 5;
self.partSpeedVariance = 10;
self.partWind = 50;
self.partFriction = 5;
self.partGravity = 1;
self.hueMin = 0;
self.hueMax = 360;
self.fworkSpeed = 4;
self.fworkAccel = 10;
self.hueVariance = 30;
self.flickerDensity = 25;
self.showShockwave = true;
self.showTarget = false;
self.clearAlpha = 25;

$(document.body).append(self.canvas);
self.ctx = self.canvas.getContext('2d');
self.ctx.lineCap = 'round';
self.ctx.lineJoin = 'round';
self.lineWidth = 1;
self.bindEvents();      
self.canvasLoop();

self.canvas.onselectstart = function() {
return false;
};
};    

self.createParticles = function(x,y, hue){
var countdown = self.partCount;
while(countdown--){
var newParticle = {
  x: x,
  y: y,
  coordLast: [
    {x: x, y: y},
    {x: x, y: y},
    {x: x, y: y}
  ],
  angle: rand(0, 360),
  speed: rand(((self.partSpeed - self.partSpeedVariance) <= 0) ? 1 : self.partSpeed - self.partSpeedVariance, (self.partSpeed + self.partSpeedVariance)),
  friction: 1 - self.partFriction/100,
  gravity: self.partGravity/2,
  hue: rand(hue-self.hueVariance, hue+self.hueVariance),
  brightness: rand(50, 80),
  alpha: rand(40,100)/100,
  decay: rand(10, 50)/1000,
  wind: (rand(0, self.partWind) - (self.partWind/2))/25,
  lineWidth: self.lineWidth
};        
self.particles.push(newParticle);
}
};


self.updateParticles = function(){
var i = self.particles.length;
while(i--){
var p = self.particles[i];
var radians = p.angle * Math.PI / 180;
var vx = Math.cos(radians) * p.speed;
var vy = Math.sin(radians) * p.speed;
p.speed *= p.friction;
        
p.coordLast[2].x = p.coordLast[1].x;
p.coordLast[2].y = p.coordLast[1].y;
p.coordLast[1].x = p.coordLast[0].x;
p.coordLast[1].y = p.coordLast[0].y;
p.coordLast[0].x = p.x;
p.coordLast[0].y = p.y;

p.x += vx;
p.y += vy;
p.y += p.gravity;

p.angle += p.wind;        
p.alpha -= p.decay;

if(!hitTest(0,0,self.cw,self.ch,p.x-p.radius, p.y-p.radius, p.radius*2, p.radius*2) || p.alpha < .05){          
  self.particles.splice(i, 1);  
}
};
};

self.drawParticles = function(){
var i = self.particles.length;
while(i--){
var p = self.particles[i];              

var coordRand = (rand(1,3)-1);
self.ctx.beginPath();               
self.ctx.moveTo(Math.round(p.coordLast[coordRand].x), Math.round(p.coordLast[coordRand].y));
self.ctx.lineTo(Math.round(p.x), Math.round(p.y));
self.ctx.closePath();       
self.ctx.strokeStyle = 'hsla('+p.hue+', 100%, '+p.brightness+'%, '+p.alpha+')';
self.ctx.stroke();        

if(self.flickerDensity > 0){
  var inverseDensity = 50 - self.flickerDensity;          
  if(rand(0, inverseDensity) === inverseDensity){
    self.ctx.beginPath();
    self.ctx.arc(Math.round(p.x), Math.round(p.y), rand(p.lineWidth,p.lineWidth+3)/2, 0, Math.PI*2, false)
    self.ctx.closePath();
    var randAlpha = rand(50,100)/100;
    self.ctx.fillStyle = 'hsla('+p.hue+', 100%, '+p.brightness+'%, '+randAlpha+')';
    self.ctx.fill();
  } 
}
};
};


self.createParsicofw = function(startX, startY, targetX, targetY){
var newParsicofw = {
x: startX,
y: startY,
startX: startX,
startY: startY,
hitX: false,
hitY: false,
coordLast: [
  {x: startX, y: startY},
  {x: startX, y: startY},
  {x: startX, y: startY}
],
targetX: targetX,
targetY: targetY,
speed: self.fworkSpeed,
angle: Math.atan2(targetY - startY, targetX - startX),
shockwaveAngle: Math.atan2(targetY - startY, targetX - startX)+(90*(Math.PI/180)),
acceleration: self.fworkAccel/100,
hue: self.currentHue,
brightness: rand(50, 80),
alpha: rand(50,100)/100,
lineWidth: self.lineWidth
};      
self.parsicofw.push(newParsicofw);

};


self.updateParsicofw = function(){
var i = self.parsicofw.length;

while(i--){
var f = self.parsicofw[i];
self.ctx.lineWidth = f.lineWidth;

vx = Math.cos(f.angle) * f.speed,
vy = Math.sin(f.angle) * f.speed;
f.speed *= 1 + f.acceleration;        
f.coordLast[2].x = f.coordLast[1].x;
f.coordLast[2].y = f.coordLast[1].y;
f.coordLast[1].x = f.coordLast[0].x;
f.coordLast[1].y = f.coordLast[0].y;
f.coordLast[0].x = f.x;
f.coordLast[0].y = f.y;

if(f.startX >= f.targetX){
  if(f.x + vx <= f.targetX){
    f.x = f.targetX;
    f.hitX = true;
  } else {
    f.x += vx;
  }
} else {
  if(f.x + vx >= f.targetX){
    f.x = f.targetX;
    f.hitX = true;
  } else {
    f.x += vx;
  }
}

if(f.startY >= f.targetY){
  if(f.y + vy <= f.targetY){
    f.y = f.targetY;
    f.hitY = true;
  } else {
    f.y += vy;
  }
} else {
  if(f.y + vy >= f.targetY){
    f.y = f.targetY;
    f.hitY = true;
  } else {
    f.y += vy;
  }
}       

if(f.hitX && f.hitY){
  self.createParticles(f.targetX, f.targetY, f.hue);
  self.parsicofw.splice(i, 1);
  
}
};
};

self.drawParsicofw = function(){
var i = self.parsicofw.length;
self.ctx.globalCompositeOperation = 'lighter';
while(i--){
var f = self.parsicofw[i];    
self.ctx.lineWidth = f.lineWidth;

var coordRand = (rand(1,3)-1);          
self.ctx.beginPath();             
self.ctx.moveTo(Math.round(f.coordLast[coordRand].x), Math.round(f.coordLast[coordRand].y));
self.ctx.lineTo(Math.round(f.x), Math.round(f.y));
self.ctx.closePath();
self.ctx.strokeStyle = 'hsla('+f.hue+', 100%, '+f.brightness+'%, '+f.alpha+')';
self.ctx.stroke();  

if(self.showTarget){
  self.ctx.save();
  self.ctx.beginPath();
  self.ctx.arc(Math.round(f.targetX), Math.round(f.targetY), rand(1,8), 0, Math.PI*2, false)
  self.ctx.closePath();
  self.ctx.lineWidth = 1;
  self.ctx.stroke();
  self.ctx.restore();
}
  
if(self.showShockwave){
  self.ctx.save();
  self.ctx.translate(Math.round(f.x), Math.round(f.y));
  self.ctx.rotate(f.shockwaveAngle);
  self.ctx.beginPath();
  self.ctx.arc(0, 0, 1*(f.speed/5), 0, Math.PI, true);
  self.ctx.strokeStyle = 'hsla('+f.hue+', 100%, '+f.brightness+'%, '+rand(25, 60)/100+')';
  self.ctx.lineWidth = f.lineWidth;
  self.ctx.stroke();
  self.ctx.restore();
}
};
};

self.bindEvents = function(){
$(window).on('resize', function(){      
clearTimeout(self.timeout);
self.timeout = setTimeout(function() {
  self.canvas.width = self.cw = $(window).innerWidth();
  self.canvas.height = self.ch = $(window).innerHeight();
  self.ctx.lineCap = 'round';
  self.ctx.lineJoin = 'round';
}, 100);
});

$(self.canvas).on('mousedown', function(e){
self.mx = e.pageX - self.canvas.offsetLeft;
self.my = e.pageY - self.canvas.offsetTop;
self.currentHue = rand(self.hueMin, self.hueMax);
self.createParsicofw(self.cw/2, self.ch, self.mx, self.my); 

$(self.canvas).on('mousemove.parsicofw', function(e){
  self.mx = e.pageX - self.canvas.offsetLeft;
  self.my = e.pageY - self.canvas.offsetTop;
  self.currentHue = rand(self.hueMin, self.hueMax);
  self.createParsicofw(self.cw/2, self.ch, self.mx, self.my);                 
});       
});

$(self.canvas).on('mouseup', function(e){
$(self.canvas).off('mousemove.parsicofw');                  
});
    
}

self.clear = function(){
self.particles = [];
self.parsicofw = [];
self.ctx.clearRect(0, 0, self.cw, self.ch);
};


self.canvasLoop = function(){
requestAnimFrame(self.canvasLoop, self.canvas);     
self.ctx.globalCompositeOperation = 'destination-out';
self.ctx.fillStyle = 'rgba(0,0,0,'+self.clearAlpha/100+')';
self.ctx.fillRect(0,0,self.cw,self.ch);
self.updateParsicofw();
self.updateParticles();
self.drawParsicofw();     
self.drawParticles();

};

self.init();    

}



var fworks = new Parsicofw();

$('#info-toggle').on('click', function(e){
$('#info-inner').stop(false, true).slideToggle(100);
e.preventDefault();
}); 

});


// -----------------------------------------

function getParameterByName(name, url) {
    if (!url) {
      url = window.location.href;
    }
  //console.log(url);
  //console.log(name);
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
  //console.log(results);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
}
var img = getParameterByName("img");
//console.log(img);
if (img !== null && img !== "" && (img.substr(0,4) === "http" || img.substr(0,2) === "//")) {
  
  //console.log("121");
  $("#bg").css("background-image", 'url("' + img + '")');
} 
</script>

</body>
</html>
